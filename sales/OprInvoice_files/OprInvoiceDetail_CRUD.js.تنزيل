var AddOprInvoiceDetail = function (_ItemBarcode) {
 
    if (_ItemBarcode == null || _ItemBarcode == '') return;
    $("#btnOprInvoicesDetails").val("Please Wait");
    $("#btnOprInvoicesDetails").attr('disabled', 'disabled');


    $.ajax({
        type: "GET",
        url: "/OprInvoice/GetItemByItemBarcode?ItemBarcode=" + _ItemBarcode,
        //data: OprInvoicesDetailItem,
        contentType: "application/json; charset=utf-8",

        dataType: "json",
        success: function (result) {
            if (result === null || result.SER===0) {
                SwalSimpleAlert("Item not found for Barcode: ", "warning");

                Swal.fire({
                    title: "Item not found for Barcode: " + _ItemBarcode,
                    icon: 'info',
                    onAfterClose: () => {
                        setTimeout(function () {
                            //$('#ItemBarcode').focus();
                            //$($this).val("");
                            //$($this).focus();
                            $("#OprInvoicesDetailsId1").val("");
                            $("#OprInvoicesDetailsId1").focus();
                        }, 0);
                    }
                });
                   return;
            } else {
                
                //   UpdateOprInvoiceFields(result.OprInvoiceTran);
                AddHTMLTableRow(result);
                $("#btnOprInvoicesDetails").val("Add Item");
                $('#btnOprInvoicesDetails').removeAttr('disabled');
                $("#OprInvoicesDetailsId1").val("");
                $("#OprInvoicesDetailsId1").focus();
                //  $('#Quantity').focus();
            }

       
        },
        error: function (errormessage) {
            SwalSimpleAlert(errormessage.responseText, "warning");
        }
    });
}

 
function UpdateOprInvoiceDetail(button) {
    var row = $(button).closest("TR");
    var _OprInvoiceDetailId = $("TD", row).eq(0).html();
    var _ItemName = $("#ItemName" + _OprInvoiceDetailId).val();

    var _IsVat = $("#IsVat").val();
    var _ItemVAT;
    if (_IsVat == "Yes") {
        _ItemVAT = $("TD", row).eq(4).html();
        $("#ItemVAT").val(_ItemVAT);
    }
    else {
        _ItemVAT = 0;
    }

    var _Quantity = parseFloat($("#Quantity" + _OprInvoiceDetailId).val());
    var _UnitPrice = parseFloat($("#UnitPrice" + _OprInvoiceDetailId).val());
    var _ItemDiscount = parseFloat($("#ItemDiscount" + _OprInvoiceDetailId).val());


    $("#btnUpdateOprInvoicesDetail" + _OprInvoiceDetailId).val("Please Wait");
    $("#btnUpdateOprInvoicesDetail" + _OprInvoiceDetailId).attr('disabled', 'disabled');

    var TRANSDT = {};
    TRANSDT.Id = _OprInvoiceDetailId;
    TRANSDT.ItemName = _ItemName;
    TRANSDT.Quantity = _Quantity;
    TRANSDT.UnitPrice = _UnitPrice;
    TRANSDT.ItemVAT = _ItemVAT;
    TRANSDT.ItemDiscount = _ItemDiscount;
    TRANSDT.TotalAmount = _Quantity * _UnitPrice;

    var _OprInvoiceTran = PreparedFormObj();
    TRANSDT.OprInvoiceTran = _OprInvoiceTran;
    var _Category = $("#Category").val();
    TRANSDT.OprInvoiceTran.Category = _Category;

    $.ajax({
        type: "POST",
        url: "/OprInvoice/UpdateOprInvoiceDetail",
        data: TRANSDT,
        dataType: "json",
        success: function (result) {
            toastr.success("Update item successfully. Item ID: " + result.Id, 'Success');
            $("#TotalAmount" + result.Id).text(result.TotalAmount);
            $("#btnUpdateOprInvoicesDetail" + _OprInvoiceDetailId).val("Update");
            $('#btnUpdateOprInvoicesDetail' + _OprInvoiceDetailId).removeAttr('disabled');

            UpdateOprInvoiceFields(result.OprInvoiceTran);
        },
        error: function (errormessage) {
            SwalSimpleAlert(errormessage.responseText, "warning");
        }
    });
}


 
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>وكيل الذكاء الاصطناعي - تجريبي</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  input, button { transition: all 0.3s ease; }
  .ai-btn { margin-left: 5px; font-size: 0.9em; }
</style>
</head>
<body class="p-4">

<h3>نموذج تجريبي</h3>
<form id="demoForm">
  <div class="mb-3 d-flex align-items-center">
    <label class="me-2">الاسم</label>
    <input type="text" id="name" class="form-control" placeholder="الاسم">
    <button type="button" class="btn btn-warning ai-btn" data-target="#name">AI</button>
  </div>
  <div class="mb-3 d-flex align-items-center">
    <label class="me-2">البريد الإلكتروني</label>
    <input type="email" id="email" class="form-control" placeholder="البريد الإلكتروني">
    <button type="button" class="btn btn-warning ai-btn" data-target="#email">AI</button>
  </div>
  <button type="submit" class="btn btn-primary">إرسال</button>
</form>

<hr>

<!-- مودال الدردشة -->
<div class="modal fade" id="aiModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">الدردشة مع الوكيل</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <textarea id="aiCommand" class="form-control" placeholder="اكتب أمرك هنا..."></textarea>
        <div id="aiResponse" class="mt-2 text-success"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="sendCommand">تنفيذ الأمر</button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
let currentTarget = null;

// فتح المودال عند الضغط على زر AI بجانب الحقل
$(".ai-btn").click(function(){
    currentTarget = $(this).data("target"); 
    $("#aiModal").modal("show");
    $("#aiCommand").focus();
});

// دوال التعديل
function addField(fieldName) {
    let uniqueId = 'field_' + Date.now();
    let fieldHtml = `<div class="mb-3 d-flex align-items-center">
        <label class="me-2">${fieldName}</label>
        <input type="text" id="${uniqueId}" class="form-control" placeholder="${fieldName}">
        <button type="button" class="btn btn-warning ai-btn" data-target="#${uniqueId}">AI</button>
    </div>`;
    $("#demoForm").append(fieldHtml);

    // إعادة ربط حدث زر AI الجديد
    $(`#${uniqueId}`).siblings(".ai-btn").click(function(){
        currentTarget = $(this).data("target"); 
        $("#aiModal").modal("show");
        $("#aiCommand").focus();
    });
}

function changeColor(selector, color) {
    $(selector).css("background-color", color);
}

function deleteField(selector) {
    $(selector).closest(".mb-3").remove();
}

// تنفيذ الأمر
function executeCommand(command) {
    if(command.action === "addField") addField(command.params[0]);
    else if(command.action === "changeColor") changeColor(command.params[0], command.params[1]);
    else if(command.action === "deleteField") deleteField(command.params[0]);
}

// الذكاء الاصطناعي المباشر بدون نوافذ prompt
function fakeAIResponse(command) {
    command = command.toLowerCase();

    // إضافة حقل جديد مباشرة
    if(command.includes("اضافة حقل") || command.includes("أضف حقل")) {
        let fieldName = command.replace(/اضافة حقل|أضف حقل/gi,'').trim() || "حقل جديد";
        return { action: "addField", params: [fieldName] };
    }

    // تغيير اللون مباشرة
    if(command.includes("تغيير اللون") || command.includes("لون")) {
        let colorMatch = command.match(/#?[a-zA-Z0-9]+$/); // يبحث عن اللون في النص
        let color = colorMatch ? colorMatch[0] : "yellow";
        return { action: "changeColor", params: [currentTarget, color] };
    }

    // حذف حقل مباشرة
    if(command.includes("حذف")) {
        // يمكن حذف أي حقل محدد بالاسم أو id
        return { action: "deleteField", params: [currentTarget] };
    }

    // أمر غير معروف
    return { action: "none", params: [] };
}

// زر تنفيذ الأمر
$("#sendCommand").click(function() {
    let cmd = $("#aiCommand").val();
    if (!currentTarget && !cmd.toLowerCase().includes("اضافة")) 
        return alert("حقل الهدف غير محدد!");

    let commandObj = fakeAIResponse(cmd);
    executeCommand(commandObj);

    // مسح المربع وإخفاء المودال
    $("#aiCommand").val("");
    $("#aiModal").modal("hide");
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نظام شجرة المجالات</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .icon-card {
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      text-align: center;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ddd;
    }
    .icon-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .step-title {
      margin-bottom: 20px;
      font-weight: bold;
      font-size: 1.5rem;
      color: #0d6efd;
    }
    .breadcrumb-path {
      margin-bottom: 20px;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body class="p-4">

  <div id="step-container">

    <!-- عرض المسار الحالي -->
    <div id="breadcrumb" class="breadcrumb-path"></div>

    <!-- الخطوة 1: اختيار المجال -->
    <div id="step-main">
      <h2 class="text-center step-title">مرحبا بك في نظام التجميع<br>اختر المجال</h2>
      <div class="row g-3" id="main-icons"></div>
    </div>

    <!-- الخطوة 2: اختيار التخصص -->
    <div id="step-specialty" style="display:none;">
      <h2 class="text-center step-title">اختر التخصص</h2>
      <div class="row g-3" id="specialty-icons"></div>
      <button class="btn btn-secondary mt-3" id="back-to-main">العودة للمجالات</button>
    </div>

    <!-- الخطوة 3: اختيار الفرع -->
    <div id="step-branch" style="display:none;">
      <h2 class="text-center step-title">اختر الفرع</h2>
      <div class="row g-3" id="branch-icons"></div>
      <button class="btn btn-secondary mt-3" id="back-to-specialty">العودة للتخصصات</button>
    </div>

    <!-- الخطوة 4: اختيار التفصيل -->
    <div id="step-detail" style="display:none;">
      <h2 class="text-center step-title">اختر التفصيل</h2>
      <div class="row g-3" id="detail-icons"></div>

      <!-- أزرار التحكم -->
      <div class="mt-3 d-flex gap-2 flex-wrap">
        <button class="btn btn-secondary" id="back-to-branch">العودة للفروع</button>
        <button class="btn btn-primary" id="btn-requests">الطلبات</button>
        <button class="btn btn-success" id="btn-work-form">استمارة العمل</button>
        <button class="btn btn-warning" id="btn-work-contract">عقد العمل</button>
      </div>
    </div>
  </div>

  <script>
    const data = [
    { main: "المجال الهندسي", spec: "الهندسة المدنية", branch: "المساحة", detail: "رفع مساحي للمشاريع الهندسية" },
      { main: "المجال الهندسي", spec: "الهندسة المدنية", branch: "المساحة", detail: "مسح التصرفات (بيع، شراء، تأجير)" },
      { main: "المجال الهندسي", spec: "الهندسة المدنية", branch: "المساحة", detail: "قضايا النزاع"  },
      { main: "المجال الهندسي", spec: "الهندسة المدنية", branch: "المساحة", detail: "تقسيم بين الورثة" },
      { main: "المجال الهندسي", spec: "الهندسة المدنية", branch: "المساحة", detail: "شبكات التثليث" }
    ];

    const unique = (arr, key) => [...new Set(arr.map(x => x[key]))];

    // استرجاع وحفظ الحالة في localStorage
    function saveState(key, value) { localStorage.setItem(key, value); }
    function getState(key) { return localStorage.getItem(key); }

    let selectedMain = getState("selectedMain") || "";
    let selectedSpec = getState("selectedSpec") || "";
    let selectedBranch = getState("selectedBranch") || "";
    let selectedDetail = getState("selectedDetail") || "";

    function updateBreadcrumb() {
      let path = selectedMain;
      if (selectedSpec) path += " \\ " + selectedSpec;
      if (selectedBranch) path += " \\ " + selectedBranch;
      if (selectedDetail) path += " \\ " + selectedDetail;
      $("#breadcrumb").text(path);
    }

    // ------------------ الخطوة 1: عرض المجالات ------------------
    function renderMainIcons() {
      const mains = unique(data, "main");
      $("#main-icons").empty();
      mains.forEach(m => {
        $("#main-icons").append(`
          <div class="col-md-3">
            <div class="icon-card" data-main="${m}">
              <i class="bi bi-grid-1x2" style="font-size:2rem"></i>
              <div>${m}</div>
            </div>
          </div>
        `);
      });
    }

    $(document).on("click", ".icon-card[data-main]", function() {
      selectedMain = $(this).data("main");
      saveState("selectedMain", selectedMain);
      selectedSpec = ""; selectedBranch = ""; selectedDetail = "";
      saveState("selectedSpec",""); saveState("selectedBranch",""); saveState("selectedDetail","");
      renderSpecialtyIcons(selectedMain);
      $("#step-main").hide();
      $("#step-specialty").show();
      updateBreadcrumb();
    });

    // ------------------ الخطوة 2: عرض التخصصات ------------------
    function renderSpecialtyIcons(main) {
      const specs = unique(data.filter(x => x.main === main), "spec");
      $("#specialty-icons").empty();
      specs.forEach(s => {
        $("#specialty-icons").append(`
          <div class="col-md-3">
            <div class="icon-card" data-spec="${s}" data-main="${main}">
              <div>${s}</div>
            </div>
          </div>
        `);
      });
    }

    $(document).on("click", ".icon-card[data-spec]", function() {
      selectedSpec = $(this).data("spec");
      saveState("selectedSpec", selectedSpec);
      selectedBranch = ""; selectedDetail = "";
      saveState("selectedBranch",""); saveState("selectedDetail","");
      renderBranchIcons(selectedMain, selectedSpec);
      $("#step-specialty").hide();
      $("#step-branch").show();
      updateBreadcrumb();
    });

    $("#back-to-main").click(function() {
      $("#step-specialty").hide();
      $("#step-main").show();
      selectedSpec = ""; selectedBranch = ""; selectedDetail = "";
      saveState("selectedSpec",""); saveState("selectedBranch",""); saveState("selectedDetail","");
      updateBreadcrumb();
    });

    // ------------------ الخطوة 3: عرض الفروع ------------------
    function renderBranchIcons(main, spec) {
      const branches = unique(data.filter(x => x.main === main && x.spec === spec), "branch");
      $("#branch-icons").empty();
      branches.forEach(b => {
        $("#branch-icons").append(`
          <div class="col-md-3">
            <div class="icon-card" data-branch="${b}" data-spec="${spec}" data-main="${main}">
              <div>${b || "---"}</div>
            </div>
          </div>
        `);
      });
    }

    $(document).on("click", ".icon-card[data-branch]", function() {
      selectedBranch = $(this).data("branch");
      saveState("selectedBranch", selectedBranch);
      selectedDetail = "";
      saveState("selectedDetail","");
      renderDetailIcons(selectedMain, selectedSpec, selectedBranch);
      $("#step-branch").hide();
      $("#step-detail").show();
      updateBreadcrumb();
    });

    $("#back-to-specialty").click(function() {
      $("#step-branch").hide();
      $("#step-specialty").show();
      selectedBranch = ""; selectedDetail = "";
      saveState("selectedBranch",""); saveState("selectedDetail","");
      updateBreadcrumb();
    });

    // ------------------ الخطوة 4: عرض التفاصيل ------------------
    function renderDetailIcons(main, spec, branch) {
      const details = unique(data.filter(x =>
        x.main === main && x.spec === spec && x.branch === branch
      ), "detail");
      $("#detail-icons").empty();
      details.forEach(d => {
        $("#detail-icons").append(`
          <div class="col-md-3">
            <div class="icon-card" data-detail="${d}">
              <div>${d || "---"}</div>
            </div>
          </div>
        `);
      });
    }

    $(document).on("click", ".icon-card[data-detail]", function() {
      selectedDetail = $(this).data("detail");
      saveState("selectedDetail", selectedDetail);
      updateBreadcrumb();
    });

    $("#back-to-branch").click(function() {
      $("#step-detail").hide();
      $("#step-branch").show();
      selectedDetail = "";
      saveState("selectedDetail","");
      updateBreadcrumb();
    });

    // ------------------ أزرار الطلبات واستعراض المستندات ------------------
$("#btn-requests").click(() => {
  let path = `${selectedMain}\\${selectedSpec}\\${selectedBranch}\\${selectedDetail}`;
  let encodedPath = encodeURIComponent(path);

  // التوجيه حسب خيار المستخدم
  if (selectedDetail === "قضايا النزاع") {
    window.location.href = `createform.html?path=${encodedPath}`;
  } 
  else if (selectedDetail === "تقسيم بين الورثة") {
    window.location.href = `createdevided.html?path=${encodedPath}`;
  } 
  else if (selectedDetail === "مسح التصرفات (بيع، شراء، تأجير)") {
    window.location.href = `createorder.html?path=${encodedPath}`;
  } 
  else if (selectedDetail === "شبكات التثليث") {
    window.location.href = `createspece.html?path=${encodedPath}`;
  } 
  else if (selectedDetail === "رفع مساحي للمشاريع الهندسية") {
    window.location.href = `createspece.html?path=${encodedPath}`;
  } 
  else {
    alert("يرجى اختيار أحد التفاصيل المحددة قبل متابعة الطلب.");
  }
});

// الصفحات الأخرى تبقى كما هي
$("#btn-work-form").click(() => window.location.href = "work-form.html");
$("#btn-work-contract").click(() => window.location.href = "work-contract.html");


    // ------------------ استعادة الحالة عند تحميل الصفحة ------------------
    $(document).ready(function() {
      updateBreadcrumb();
      if (selectedMain && !selectedSpec) {
        renderSpecialtyIcons(selectedMain);
        $("#step-main").hide(); $("#step-specialty").show();
      }
      if (selectedMain && selectedSpec && !selectedBranch) {
        renderSpecialtyIcons(selectedMain);
        renderBranchIcons(selectedMain, selectedSpec);
        $("#step-main").hide(); $("#step-specialty").hide(); $("#step-branch").show();
      }
      if (selectedMain && selectedSpec && selectedBranch) {
        renderSpecialtyIcons(selectedMain);
        renderBranchIcons(selectedMain, selectedSpec);
        renderDetailIcons(selectedMain, selectedSpec, selectedBranch);
        $("#step-main").hide(); $("#step-specialty").hide(); $("#step-branch").hide(); $("#step-detail").show();
      }
    });

    renderMainIcons();
  </script>

</body>
</html>
